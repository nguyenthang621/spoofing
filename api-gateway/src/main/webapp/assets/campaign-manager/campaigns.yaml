title:
  index: Auto Dial
  create: Tạo Chương trình
  update: Sửa Chương trình ${name}
  view: <small>Chương trình</small> ${name}
apiEndpoint: /services/outbound-dialer/api/campaigns
queryParams:
  type:
    - 202
    - 302
predicate: startAt
ascending: false
columns:
  - prop: name
    label: Tên
  - prop: state
    label: Trạng thái
    options:
      - value: 204
        label: Finished
      - value: 200
        label: Enable
      - value: 102
        label: Preparing
      - value: 103
        label: Pending
      - value: 301
        label: Running
      - value: 509
        label: Paused
      - value: 417
        label: Expired
      - value: 402
        label: Paused
      - value: 403
        label: Disabled
      - value: 400
        label: ERROR
  - prop: shortMsg
    label: Nội dung
  - prop: tags
    label: File đã nhập
  - prop: startAt
    label: Bắt đầu
  - prop: expiredAt
    label: Hết hạn
  - prop: meta.http-202
    label: Thành công
  - prop: meta.http-403
    label: Lỗi
  - prop: meta.remain
    label: Còn lại
    template: <%= (meta['total'] - (meta['http-202'] || 0) - (meta['http-403'] || 0)) %>
  - prop: meta.total
    label: Đã nhập
fields:
  - type: tabset
    fieldGroup:
      - templateOptions:
          label: Thông tin cơ bản
        fieldGroup:
          - fieldGroupClassName: row
            fieldGroup:
              - key: name
                type: input
                className: col-md-6
                templateOptions:
                  label: Tên chương trình
                  description: Campaign Name that appear on Notification Email
                  required: true
                  maxlength: 80
              - key: type
                type: select
                className: col-md-6
                defaultValue: 202
                templateOptions:
                  label: Loại
                  required: true
                  options:
                    - value: 202
                      label: Một lần
                    - value: 302
                      label: Lặp lại
              - key: rateLimit
                type: input
                className: col-md-6
                defaultValue: 20
                templateOptions:
                  label: Tốc độ
                  description: TPS
                  required: true
                  type: number
              - key: state
                type: select
                className: col-md-6
                defaultValue: 200
                templateOptions:
                  label: Trạng thái
                  required: true
                  options:
                    - value: 200
                      label: Bật
                    - value: 403
                      label: Tắt
              - key: startAt
                type: datetime
                className: col-md-6
                hideExpression: model.type !== 202
                expressionProperties:
                  model.startAt: 'model.startAt || formState.moment().format()'
                templateOptions:
                  label: Bắt đầu
                  format: 'YYYY-MM-DDTHH:mm:ssZ'
                  displayFormat: 'YYYY-MM-DD HH:mm'
              - key: expiredAt
                type: datetime
                hideExpression: model.type !== 202
                className: col-md-6
                expressionProperties:
                  model.expiredAt: 'model.expiredAt || formState.moment().add(1, "hour").format()'
                templateOptions:
                  label: Hết hạn
                  format: 'YYYY-MM-DDTHH:mm:ssZ'
                  displayFormat: 'YYYY-MM-DD HH:mm'
      - templateOptions:
          label: Call Configuration
        fieldGroup:
          - key: payload
            fieldGroupClassName: row
            fieldGroup:
              - key: channel
                type: input
                className: col-md-6
                templateOptions:
                  label: Channel
                  description: The channel to use for the new call, in the form technology resource as in the Dial application.
                  required: true
              - key: callerid
                type: input
                className: col-md-6
                templateOptions:
                  label: Callerid
                  description: The caller id to use
              - key: waitTime
                type: input
                className: col-md-4
                defaultValue: 45
                templateOptions:
                  label: WaitTime
                  description: How many seconds to wait for an answer before the call fails (ring cycle)
                  type: number
              - key: maxRetries
                type: input
                className: col-md-4
                defaultValue: 0
                templateOptions:
                  label: MaxRetries
                  description: Number of retries before failing, not including the initial attempt. Default = 0 e.g. don't retry if fails.
                  type: number
              - key: retryTime
                type: input
                className: col-md-4
                defaultValue: 300
                expressionProperties:
                  templateOptions.disabled: '!model.maxRetries'
                templateOptions:
                  label: RetryTime
                  description: How many seconds to wait before retry. The default is 300 (5 minutes)
                  type: number
              - key: account
                type: input
                className: col-md-12
                templateOptions:
                  label: Account
                  description: The account code for the call. This value will be assigned to CDR(accountcode)
              - key: application
                type: input
                className: col-md-6
                templateOptions:
                  label: Application
                  description: The application to execute
              - key: data
                type: input
                className: col-md-6
                expressionProperties:
                  templateOptions.disabled: "!model.application"
                templateOptions:
                  label: Data
                  description: The application arguments
              - key: context
                type: input
                className: col-md-4
                expressionProperties:
                  templateOptions.disabled: "model.application"
                templateOptions:
                  label: Context
                  description: The context in the dialplan
              - key: extension
                type: input
                className: col-md-4
                expressionProperties:
                  templateOptions.disabled: "model.application"
                templateOptions:
                  label: Extension
                  description: The extension in the specified context
              - key: priority
                type: input
                className: col-md-4
                defaultValue: 1
                expressionProperties:
                  templateOptions.disabled: "model.application"
                templateOptions:
                  label: Priority
                  description: The priority of the specified extension (numeric or label)
              - key: setvar
                type: tags
                className: col-md-12
                templateOptions:
                  label: Setvar
                  description:
      - templateOptions:
          label: MSISDN Lists
        fieldGroup:
          - fieldGroupClassName: row
            fieldGroup:
              - key: datasource
                type: select
                className: col-md-6
                defaultValue: 101
                templateOptions:
                  label: Data Source
                  description: Where to pull the list of MSISDN numbers
                  required: true
                  options:
                    - value: 100
                      label: Text Input
                    - value: 101
                      label: File upload
              # - key: shortMsg
              #   type: textarea
              #   className: col-md-12
              #   expressionProperties:
              #   templateOptions:
              #     label: Message Template
              #     cols: 80
              #     rows: 5
              #     description: Call file template. See https://www.voip-info.org/asterisk-auto-dial-out/
              ## Datasource Settings
              - key: meta.headers
                type: input
                className: col-md-9
                defaultValue: msisdn
                templateOptions:
                  label: Column Headers
                  description: First row of CSV file or Excel file contains column names to import. Each column separate by comma or tab character.
                  required: true
              - key: meta.pkey
                type: input
                className: col-md-3
                defaultValue: msisdn
                templateOptions:
                  label: MSISDN Column
                  description: Name of the MSISDN column
                  required: true
              # TEXT INPUT
              - key: meta.msisdnText
                type: textarea
                hideExpression: 'formState.mainModel.datasource !== 100'
                className: col-md-12
                templateOptions:
                  label: File Content
                  description: Please copy and paste the MSISDN file want to broadcast to. Each MSISDN in a row, or comman separated.
                  cols: 80
                  rows: 5
              # FILE UPLOAD
              - key: attachments
                type: file-gridfs
                hideExpression: 'formState.mainModel.datasource !== 101'
                className: col-md-12
                templateOptions:
                  label: Attachments
                  description: MSISDN numbers to broadcast message to. Each MSISDN should be put in one row.
                  isImage: false
                  apiEndpoint: api/minio
                  fileSrc: 'api/public/download-file?name=${fileId}'
details:
  - key: name
    type: template
    expressionProperties:
      templateOptions.innerHTML: "`<h3>${model.name} <code>${model.state}</code></h3>`"
  - prop: tags
    type: template
    expressionProperties:
      templateOptions.innerHTML: "`<p>File đã nhập: ${model.tags.join(', ') }</p>`"
    label:
  - key: shortMsg
    type: template
    expressionProperties:
      templateOptions.innerHTML: "`<p>Nội dung:<br/><code>${model.shortMsg}</code></p>`"
  - key: startAt
    type: template
    expressionProperties:
      templateOptions.innerHTML: "`<p class='d-flex justify-content-between'>${model.startAt} ${model.expiredAt}</p>`"
  - key: metaStats
    type: template
    expressionProperties:
      templateOptions.innerHTML: "`<h3 class='d-flex justify-content-between'><span class='badge badge-success'>Gửi thành công: ${model.meta['http-202'] || 0}</span> <span class='badge badge-danger'>Gửi lỗi: ${model.meta['http-403'] || 0}</span> <span class='badge badge-info'>Tổng cộng: ${model.meta.total || 0}</span> <span class='badge badge-primary'>Còn lại: ${ (model.meta['total'] - (model.meta['http-202'] || 0) - (model.meta['http-403'] || 0)) }</span></h3>`"
  - key: rateLimit
    type: input
    className: col-md-6
    defaultValue: 20
    templateOptions:
      label: Rate Limit
      description: SMS send out per second
      required: true
      type: number
  - key: update
    type: button
    expressionProperties:
      templateOptions.body: "_.get(formState, 'mainModel')"
    templateOptions:
      label: Update Rate Limit
      method: PUT
      errorMsg: Cannot update Rate Limit
      okMsg: Successfully update Rate Limit
      apiEndpoint: /services/outbound-dialer/api/campaigns
      body:
  - fieldGroup:
      - key: stop
        type: button
        expressionProperties:
          templateOptions.apiEndpoint: "`/services/outbound-dialer/api/management/stop-campaign/${model.id}`"
        templateOptions:
          label: STOP
          method: GET
          btnType: danger
      - key: pause
        type: button
        expressionProperties:
          templateOptions.apiEndpoint: "`/services/outbound-dialer/api/management/pause-campaign/${model.id}`"
        templateOptions:
          label: Pause
          method: GET
          btnType: warning
      - key: resume
        type: button
        expressionProperties:
          templateOptions.apiEndpoint: "`/services/outbound-dialer/api/management/resume-campaign/${model.id}`"
        templateOptions:
          label: Resume
          method: GET
          btnType: success
      - key: start
        type: button
        expressionProperties:
          templateOptions.apiEndpoint: "`/services/outbound-dialer/api/management/start-campaign/${model.id}`"
        templateOptions:
          label: Start
          method: GET
          btnType: primary
      - key: stats
        type: button
        expressionProperties:
          templateOptions.apiEndpoint: "`/services/outbound-dialer/api/management/stats-campaign/${model.id}`"
        templateOptions:
          label: Statistics
          method: GET
          btnType: dark
